import datetime
from tinkoff.invest.utils import now
from tinkoff.invest import CandleInterval
import matplotlib.pyplot as plt
import numpy as np

from Methods.historical_shares_prices import historical_shares_prices_func

# На вход figi номер акции, начальный тайм стемп, конечный таймстеп, интервал c какой переодичностью беруться данные
# На выход масив таймстемпов, массив цены акции
#x, y = historical_shares_prices_func("BBG004730N88", datetime.datetime(2023, 11, 1, tzinfo=datetime.timezone.utc), now(), CandleInterval.CANDLE_INTERVAL_DAY)

x, y = historical_shares_prices_func("BBG004730JJ5", datetime.datetime(2022, 11, 6, tzinfo=datetime.timezone.utc), now(), CandleInterval.CANDLE_INTERVAL_DAY)
plt.plot(x, y)
plt.show()

#t1=datetime.datetime(2022, 11, 4, 9, 0, tzinfo=datetime.timezone.utc)
def profitability_by_n_periods(ticker, n, from_timestemp, to_timestemp):
    Div=0
    C1=0
    C0=0
    middle_profit=(C1-C0+Div)/C0/n
    return middle_profit

def risk(ticker, from_timestemp, to_timestemp):
    _, y = historical_shares_prices_func(ticker, from_timestemp, to_timestemp, CandleInterval.CANDLE_INTERVAL_DAY)
    std=np.std(np.asarray(y))
    return std

#print(risk("BBG004730N88", datetime.datetime(2023, 10, 1, tzinfo=datetime.timezone.utc), now()))

indicative_papers=["BBG004730JK3", "BBG004730N88", "BBG004730N88"]